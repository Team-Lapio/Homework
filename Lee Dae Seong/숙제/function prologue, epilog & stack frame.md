# 함수 프롤로그, 에필로그 & 스택 프레임

#### 함수의 호출

- 함수 호출은 크게 다음가 같이 나뉘어 진다.
  - 1. 함수가 사용할 파라미터를 스택에 넣고 함수 시작지점으로 점프(함수 호출)한다.
    2.  __함수 내에서 사용할 스택프레임을 설정한다. (프롤로그)__
    3.  함수의 내용을 수행한다.
    4.  __수행을 마치고 처음 호출한 지점으로 돌아가기 위해 스택을 복원한다. (에필로그)__ 

----

#### 함수 프롤로그 & 에필로그

__함수 프롤로그__

-> 베이스 포인터(ebp)를 스택에 저장하고 현재 스택포인터(esp)를 베이스포인터(ebp)에다가 저장함

__함수 에필로그__

-> 현재 스택 포인터(esp)를 베이스포인터(ebp)로 복구한 후 베이스 포인터(ebp)를 복구해준다.

---

#### 스택 프레임

__어떤 함수가 호출되었을 때 그 함수가 가지는 공간 구조이다.__
 스택프레임은 코딩의 순서에 맞춰 LIFO 구조로 차곡차곡 쌓여진다. 

1. esp라는 포인터가 사용되게 되는데 흔히 스택 포인터라고 하며 현재 데이터의 위치를 알려준다. 
2. ebp라는 흔히 베이스 포인터라고 일컫는 또 다른 포인터가 있는데, 이는 스택 프레임이 시작된 위치의 주소값을 가르키며 
3. 나중에 esp가 시작점으로부터 얼마나 벗어나 있는지를 가리킨다. 
4. 스택 프레임은 해당 스택 프레임의 함수가 종료될때 함께 소멸된다. 
5.  ebp는 돌아와야 할 주소 값을 가리킨다

---

- Stack Frame은 함수의 호출 과정에서 호출되는 함수가 사용하기 위해 할당되는 stack의 공간을 의미한다. 

- 프로그램이 실행되면 가장 먼저 Main 함수의 Stack Frame을 할당한다. Main함수가 A 함수를 호출하면서 A의 Stack Frame을 할당하고, 다시 A함수 내에서 B함수를 호출하면 B의 Stack Frame을 할당한다.
- Stack Frame에는 함수를 호출할 때 입력한 전달 인자, 함수가 종료될 때 복귀할 명령어의 주소, 이전 Stack Frame의 EBP값을 저장하고, 지역변수를 저장하기 위해 공간을 할당한다.

